---
tags: #InternetProtocol #IP
---
{{{ ###Addressing
- 32 binary bit space (4 byte)
- IPv6 128 bits (16 byte)
- adressing 
	- Identifies hosts
	- Provides logical location service
- Special Ranges (CIDR)
	- Class A:	000-127 in first 8 bits			(0-15  Preceding ones)
	- Class B:	128-191 in the first 16 bits	(16-23 Preceding ones)
	- Class C:	192-223 in the first 24 bits  	(24-32 Preceding ones)
	- Class D:	224-239 in the first 8 bits
	- Class E:	240-255 in the first 8 bits
	- Broadcast:	255.255.255.255 The limited broadcast address is used for one-to-everyone delivery on the local subnet when the local network ID is unknown. IPv4 nodes typically only use the limited broadcast address during an automated configuration process such as Bootstrap Protocol (BOOTP) or DHCP. For example, with DHCP, a DHCP client must use the limited broadcast address for all traffic sent until the DHCP server acknowledges the use of the offered IPv4 address configuration. IPv4 routers do not forward limited broadcast packets.
	- Unspecified:	0.0.0.0 Unspecified Address: An Unspecified Address is typically used as the source address for packets that are attempting to verify the uniqueness of the tentative unicast address. It's neither assigned to any interface nor used as the destination address. When a host computer starts up, the DHCP client software sends a special broadcast packet, known as a DHCP Discover message. This message uses the subnet's broadcast address (all host ID bits set to one) as the destination address and 0.0.0.0 as the source address.
	- Loopback: 	127.0.0.0/8 It is not unusual for a host to use TCP/IP sockets internally to implement interprocess communication. To facilitate this use and to ensure a machine always has an IP address that it can use to communicate with itself, the IP address scheme has a concept of a loopback address. A loopback address, which by standard lies in the 127.0.0.0/8 network range, instructs the system to transmit data to itself. This loopback address is automatically assigned to a host when TCP/IP is running, almost always to 127.0.0.1. Note that this address is locally significant; every TCP/IP host thinks it is the sole owner of its loopback address.
	- Private address space: 10.0.0.0/8, 172.16.0.0/12 (usually subnetted to /16), and 192.168.0.0/16 (usually subnetted to /24). Private addressing allows organizations to use a large address space internally on their network while using only a few public addresses, rather than using only public addresses. The approved private addresses in IPv4 are 10.0.0.0/8, 172.16.0.0/12 (usually subnetted to /16), and 192.168.0.0/16 (usually subnetted to /24). Generally organizations will not route these addresses outside of their network; it is possible, but once you send packets with these addresses outside of your network control, you have no idea what your ISP will do with them.
	- Link-Local: A link-local address - also known as Automatic Private IP Addressing (APIPA) - is allocated for communication between hosts on a single network. The allocated range for link-local addresses is 169.254.0.0/16. Windows hosts will autoconfigure a link-local address if it is configured to get an IP address via DHCP, but fails. These addresses should NEVER be used for actually passing traffic. UNIX hosts generally do not assign link-local addresses.
}}} ###
{{{ ###Fields (Great visual in the Pictures Folder)
> Version: The first field in the IP header is the Version field. For IPv4, this has a value of 4 (hence the name IPv4). The field has a value of 6 for IPv6.

> Internet Header Length (IHL) (field size is 4 bits): The Internet Header Length (IHL) field indicates the number of 4-byte blocks in the IPv4 header. The IPv4 header has a minimum of 20 bytes in size (the smallest value of the IHL field is 5) to a maximum of 60 bytes.

> Type of Service (field size is 8 bits): The primary purpose of this field is to provide a means of prioritizing datagrams that are waiting to pass through a router. Most implementations of IP today simply put all 0s in this field.

> RFC 2474 provides the modern definition as the Differentiated Services (DS) field. The high-order 6 bits of the DS field comprise the DS Code Point (DSCP) field. The DSCP field allows devices in a network to mark, unmark, and classify packets for forwarding. This is usually done based on the needs of an application. For example, Voice over IP and other real-time packets take precedence over e-mail in congested areas of the network. This is commonly referred to as Quality of Service (QoS). Low-order 2 bits of the Type of Service field are used for Explicit Congestion Notification (ECN), as defined in RFC 3168.

> Total Length: The Total Length field indicates the length of the IPv4 packet, measured in octets, including Internet header and data.

> Identification: This field is primarily used for uniquely identifying the group of fragments of a single IP datagram to aid in assembling the fragments of a packet. Some experimental work has suggested using the ID field for other purposes, such as for adding packet-tracing information to help trace datagrams with spoofed source addresses, but RFC 6864 now prohibits any such use.

> Flags (field size is 3 bits): The Flags field identifies flags for the fragmentation process. The size of this field is 3 bits; however, only 2 bits are defined for current use. There are two flags: one to indicate whether the IPv4 packet can be fragmented, which is the DF (or Don't Fragment) flag; and another to indicate whether more fragments follow the current fragment, which is MF (or More Fragments) flag. We will discuss fragmentation later in this module.

> Fragment Offset (field size is 13 bits): The Fragment Offset field indicates the position of the fragment relative to the beginning of the original IPv4 payload. We will discuss fragmentation later in this module.

> Time to Live: This field indicates the maximum time (measured in hops) the datagram is allowed to remain in the Internet system. If this field contains the value zero, then the datagram must be destroyed. Different operating systems use different default values, which can be helpful when trying to guess a user's operating systems and device types: in UNIX, the default initial value is 64; Windows is 128; and Networking devices such as Cisco is 255.

> Protocol (field size is 8 bits): The Protocol field identifies the upper-layer protocol that is to receive the IPv4 packet payload. For example, a value of 6 in this field identifies TCP as the upper-layer protocol; a decimal value of 17 identifies UDP, and a value of 1 identifies ICMPv4.

> Header Checksum (field size is 16 bits): This field provides a checksum on the IPv4 header only. A checksum is a count of the number of bits in a transmission unit that is included with the unit so that the receiver can check to see whether the same number of bits arrived. If the counts match, it is assumed the complete transmission was received. Each IPv4 node that receives IPv4 packets verifies the IPv4 header checksum and silently discards the IPv4 packet if checksum verification fails. The IPv4 payload is not included in the checksum calculation because the IPv4 payload usually contains its own checksum.

> Source Address (field size is 32 bits): The Source Address field stores the IPv4 address of the originating host.

> Destination Address (field size is 32 bits): The Destination Address field stores the IPv4 address of an intermediate destination (in the case of source routing) or the destination host.

> Options (field size is a multiple of 32 bits [or 4 bytes]): The Options field stores one or more IPv4 options. Examples of options include timestamp, traceroute, and IP router alert. If an IPv4 option does not use all 32 bits, padding options must be added so that the IPv4 header is an integral number of 4-byte blocks that can be indicated by the IHL field. The Internet header padding is used to ensure that the Internet header ends on a 32 bit boundary.

> RFC: A Request for Comments (RFC) is a publication of the Internet Engineering Task Force (IETF) and the Internet Society, the principal technical development and standards-setting bodies for the Internet.

> RFC Memorandum: An RFC is authored by engineers and computer scientists in the form of a memorandum describing methods, behaviors, research, or innovations applicable to the working of the Internet and Internet-connected systems. It is submitted either for peer review or simply to convey new concepts, information, or (occasionally) engineering humor. The IETF adopts some of the proposals published as RFCs as Internet standards.
}}} ###
{{{ ###Fragmentation and MTU Max Transmission Unit
> MTU: The size in bytes of the largest packet the data link layer can handle
- The three fields within the IP header that are involved in packet fragmentation include: Identification, Flags, and Fragment Offset.

- Identification field: will be identical for each fragment to indicate that the fragments are all part of the same packet.
- Three flag bits:
	- 1st bit: Unused always zero
	- 2nd bit: DF (Don't Fragment) (0=Allowed 1=Not Allowed)
	- 3rd bit: MF (More Fragments) (0=No more fragments, 1=More Fragments to come)
- Fragment Offset: field indicates the position of the fragment relative to the beginning of the original IPv4 payload. The fragment offset is measured in units of 8 bytes (or 64 bits). The first fragment has offset of zero and can be as high as 8191.

## Fragment table
MF	| Offset	| Relevance
--- | ---		| ---
Off	| 0			| Whole Packet
On	| 0			| First Fragment
On	| Not 0		| Middle Fragment
Off	| Not 0		| Last Fragment

## Fragmentation size example
	> Question	: An IP packet containing 12,000 bytes of data (not including the header) needs to be sent over a link with an MTU of 3,300. What will be the fragment offset value in the IP header of the second fragment?
	> Answer	: The size of the packet is larger than the link's MTU, so the packet will need to be fragmented. Fragment offsets are specified in units of 8 bytes, which is why fragment length must be a multiple of 8. In this example the payload of the first fragment is 3280 (3300 - 20 bytes for the header). The first fragment would have a fragment offset of 0, and the second would have an offset of 410 (3,280 divided by 8). The third would have an offset of 820 (6,560 divided by 8). The fourth would have an offset of 1230, etc.

## Fun Facts
- IP Header length is 20 bytes
- ICMP Header lenght is 8 bytes. (If packet is split, the ICMP header is only on the first packet
- PHD (Packet Hexdump Decoder) is like wireshark
- If the payload is abcedfghijklmnopqrstuvw repeating, it is probably coming form a windows box.
- If the overall fragment size is 1500, the payload is 1480, becasue the header is 20 bytes. 
- If packets are missing, wireshark will not assemble the packet
- ICMP is less than a layer three protocol
- ICMP redirect codes are usually used to indicate a better route.
}}} ###
{{{ ###Resources
(Packet Decoding Calculator)[https://www.gasmi.net/hpd/]
}}} ###